<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>🤔 Why compile time evaluation - Const Generics Project Group</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../skill-tree.css">
        <link rel="stylesheet" href="../skill-tree-finetuning.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html">👋🏽 Welcome</a></li><li class="chapter-item expanded "><a href="../CHARTER.html">📜 Charter</a></li><li class="chapter-item expanded "><a href="../vision.html">🔮 The vision</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../vision/why-compile-time-evaluation.html" class="active">🤔 Why compile time evaluation</a></li><li class="chapter-item expanded "><a href="../vision/characters.html">🙋‍♀️ Cast of characters</a></li><li class="chapter-item expanded "><a href="../skill-tree.html">🔀 Skill Tree</a></li><li class="chapter-item expanded "><a href="../vision/status_quo.html">😱 Status quo</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../vision/status_quo/array_default.html">Array defaults</a></li><li class="chapter-item expanded "><a href="../vision/status_quo/split_first.html">Array split first method</a></li><li class="chapter-item expanded "><a href="../vision/status_quo/nalgebra.html">nalgebra</a></li></ol></li><li class="chapter-item expanded "><a href="../vision/shiny_future.html">✨ Shiny future</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../vision/shiny_future/array_default.html">Array defaults</a></li><li class="chapter-item expanded "><a href="../vision/shiny_future/split_first.html">Array split first method</a></li><li class="chapter-item expanded "><a href="../vision/shiny_future/image_type.html">Image type in rust-gpu</a></li></ol></li><li class="chapter-item expanded "><a href="../vision/roadmap.html">📅 Roadmap for 2021</a></li><li class="chapter-item expanded "><a href="../vision/how_to_vision_doc.html">❓How to vision doc</a></li></ol></li><li class="chapter-item expanded "><a href="../meetings/index.html">🔍 Meetings</a></li><li class="chapter-item expanded "><a href="../design/index.html">📚 Design</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../design/constraining-generic-parameters.html">❗ Constraining generic parameters</a></li><li class="chapter-item expanded "><a href="../design/generic-const-param-types.html">❗⚖️🔄 Generic const parameter types</a></li><li class="chapter-item expanded "><a href="../design/leaking-implementation-details.html">❗🔙 Leaking implementation details</a></li><li class="chapter-item expanded "><a href="../design/opaque-and-transparent-assoc-consts.html">❗🔙 Opaque and transparent associated constants</a></li><li class="chapter-item expanded "><a href="../design/const-eval-requirements.html">❗🔙 Restrictions on const evaluation</a></li><li class="chapter-item expanded "><a href="../design/structural-equality.html">❗🔙 ⚖️ Structural equality</a></li><li class="chapter-item expanded "><a href="../design/unused-substs.html">❗🔙 🔄 Unused substs</a></li><li class="chapter-item expanded "><a href="../design/valid-const-parameter-types.html">❗⚖️ Valid const parameter types</a></li><li class="chapter-item expanded "><a href="../design/valtrees.html">❗ Valtrees</a></li><li class="chapter-item expanded "><a href="../design/exhaustiveness.html">❔ Exhaustiveness</a></li><li class="chapter-item expanded "><a href="../design/functions-as-const-parameters.html">❔🔙 Functions as const parameters</a></li></ol></li><li class="chapter-item expanded "><a href="../draft-rfcs/index.html">✏️ Draft RFCs</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Const Generics Project Group</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/project-const-generics" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="why-compile-time-evaluation"><a class="header" href="#why-compile-time-evaluation">Why compile time evaluation?</a></h1>
<p>This section is, in many ways, the most important. It aims to clarify the reasoning about any future decisions about const generics and const evaluation.</p>
<h2 id="why-do-we-want-to-evaluate-things-at-compile-time"><a class="header" href="#why-do-we-want-to-evaluate-things-at-compile-time">Why do we want to evaluate things at compile time?</a></h2>
<p>People already precompute certain data structures, lookup tables, and so on, at compile time.
For example the crate <code>regex</code> could be able to compile a regex at compile time,
improving the performance when using <code>regex</code> and even removing the need for runtime allocations.
Const evaluation is also very useful to assert correctness requirements at compile time, instead
of using a runtime panic.</p>
<p>Without good const evaluation support, is often easier to just use a <code>build.rs</code> file for this or compute it externally and generate the result outside of the ordinary compilation process. This is both worse for the user, as they essentially have to learn yet another
meta language, and also negatively impacts the compilation speed and incremental compilation. If that isn't possible or sensible, one often just requires the computation to happen at runtime, negatively impacting startup performance.</p>
<p>Computing things outside without using const eval makes it at lot more cumbersome to use and
prevents the input for that computation to simply be a generic or function parameter.</p>
<h2 id="why-const-generics"><a class="header" href="#why-const-generics">Why const generics?</a></h2>
<p>Const evaluation by itself is good enough unless it should influence the type system. </p>
<p>This is needed when computing the layout of types, most often by using arrays.
Using arrays instead of dynamic allocations or slices can improve performance, reduces the dynamic memory footprint
and can remove runtime checks and implicit invariants.</p>
<p>Another reason is to be generic over configurations or to move certain conditions to compile time. Consider <a href="https://github.com/EmbarkStudios/rust-gpu/blob/1431c18b9db70feafc64e5096a64e5fefffbed18/crates/spirv-std/src/image.rs#L31">image handles</a> in <a href="https://github.com/EmbarkStudios/rust-gpu"><code>rust-gpu</code></a> or TODO: example for state machines.</p>
<h2 id="what-are-our-goals"><a class="header" href="#what-are-our-goals">What are our goals?</a></h2>
<h3 id="consistent-just-add-const"><a class="header" href="#consistent-just-add-const">Consistent: &quot;just add <code>const</code>&quot;</a></h3>
<p>Writing code that works at compile time should at most require manually adding the needed <code>const</code> annotations at suggested places (or even automatically using <code>rustfix</code> or IDE support)
until everything compiles. One should not be required to avoid large parts of the language to do this.
Adding and using const parameters should be straight forward without weird restrictions or a lot required knowledge.
Using const generic items from different libraries should work without issues.</p>
<h3 id="approachable-what-is-u8-my_expr-and-why-is-it-needed"><a class="header" href="#approachable-what-is-u8-my_expr-and-why-is-it-needed">Approachable: &quot;what is <code>[u8; my_expr]:,</code> and why is it needed&quot;</a></h3>
<p>Reading or writing code which can be used at compile time should ideally not be more complex
than writing other code. Requiring a lot of weird trait bounds or other hacks should be avoided as much as possible.
Supporting compile time evaluation should not worsen the experience of users, especially for beginners.</p>
<h3 id="reliable-if-it-passes-cargo-check-it-works"><a class="header" href="#reliable-if-it-passes-cargo-check-it-works">Reliable: &quot;if it passes <code>cargo check</code>, it works&quot;</a></h3>
<p>Const evaluation failures should be detected as early as possible, even when using <code>cargo check</code>. When writing library code, incorrect constants
should cause warnings and errors whenever possible.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../vision.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../vision/characters.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../vision.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../vision/characters.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../viz.js"></script>
        <script type="text/javascript" src="../panzoom.min.js"></script>
        <script type="text/javascript" src="../full.render.js"></script>
        <script type="text/javascript" src="../skill-tree.js"></script>
    </body>
</html>
